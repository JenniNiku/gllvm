<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Extract species covariances due to environmental random effects from gllvm object — getEnvironCov.gllvm • gllvm</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Extract species covariances due to environmental random effects from gllvm object — getEnvironCov.gllvm"><meta name="description" content="Calculates the species environment covariance matrix for a gllvm object."><meta property="og:description" content="Calculates the species environment covariance matrix for a gllvm object."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gllvm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.7</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/vignette1.html">Analysing multivariate abundance data using gllvm</a></li>
    <li><a class="dropdown-item" href="../articles/vignette2.html">Analysing high-dimensional microbial community data using gllvm</a></li>
    <li><a class="dropdown-item" href="../articles/vignette3.html">Introduction to gllvm Part 1: Ordination</a></li>
    <li><a class="dropdown-item" href="../articles/vignette4.html">Introduction to gllvm Part 2: Species correlations</a></li>
    <li><a class="dropdown-item" href="../articles/vignette5.html">How to use the quadratic response model</a></li>
    <li><a class="dropdown-item" href="../articles/vignette6.html">Ordination with predictors</a></li>
    <li><a class="dropdown-item" href="../articles/vignette7.html">Phylogenetic random effects</a></li>
    <li><a class="dropdown-item" href="../articles/vignette8.html">Analysing sparse ecological percent cover data using gllvm</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/JenniNiku/gllvm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Extract species covariances due to environmental random effects from gllvm object</h1>
      <small class="dont-index">Source: <a href="https://github.com/JenniNiku/gllvm/blob/HEAD/R/getEnvironCov.gllvm.R" class="external-link"><code>R/getEnvironCov.gllvm.R</code></a></small>
      <div class="d-none name"><code>getEnvironCov.gllvm.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Calculates the species environment covariance matrix for a gllvm object.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S3 method for class 'gllvm'</span></span>
<span><span class="fu">getEnvironCov</span><span class="op">(</span><span class="va">object</span>, x <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>an object of class 'gllvm'.</p></dd>


<dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>(optional) vector of covariate values to calculate the covariance for. Defaults to a vector of 1s. If both 'randomX' and random species effects are present in the model this should be a list of length two.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>not used</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Function returns the following components:</p>
<dl><dt>cov</dt>
<dd><p>species covariances due to covariates</p></dd>

 <dt>trace.randomB</dt>
<dd><p>trace of the covariance matrix due to random canonical coefficients</p></dd>

 <dt>trace.randomB.quad</dt>
<dd><p>trace of the covariance matrix components due to squared model terms</p></dd>

 <dt>trace.col.eff</dt>
<dd><p>trace of the covariance matrix due to random column (species) effects</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Species covariance matrix due to the environment is calculated.</p>
<p>Covariances due to the covariates can only be calculated when random effects are included in the model, and are thus limited to reduced rank models (those including constrained and concurrent ordinations) fitted with random slopes, models fitted with random effects via the formula interface, or the fourth corner model fitted with random slopes.
For full rank models with random slopes, i.e., with the formula interface or the fourth corner model, the covariances of species are formulated as:</p>
<p>$$\Sigma_e = kronecker(C\rho + (1-\rho)I_p, R),$$</p>
<p>where \(C\) is a correlation matrix for the columns in the response (e.g., a Phylogenetic matrix), \(\rho\) the signal parameter, and R the covariance matrix for the random effects. Here, $$I = kronecker(I_p, x)$$, with x a vector of covariate values for each of the random effects, which defaults to a vector of 1s.
when there are covariate-specific phylogenetic signal parameters in the model, this is instead:</p>
<p>$$\Sigma_e = kronecker(x_i', I_m)*bdiag(L_k)*kronecker(\Sigma_r, I_m)*bdiag(L_k')*kronecker(x_i, I_m),$$</p>
<p>where \(bdiag(L_k)\) is a block-diagonal lower triangular matrix, and each \(L_k\) the lower triangular matrix of the covariance matrix for each covariate.</p>
<p>For reduced rank models, the covariance is separately defined for the different variance structures of the canonical coefficients in the package. With LV-specific variances, we have:</p>
<p>$$\Sigma_e = \Theta*S*\Theta',$$</p>
<p>where \(\Theta\) is the matrix of loadings, and S the (diagonal) covariance matrix for the canonical coefficients. With predictor-specific variances, we instead have:</p>
<p>$$\Sigma_e = \sum^K_{k=1} \Theta(I_d*\sigma_k^2)\Theta',$$</p>
<p>with I_d an identity matrix for the number of constrained and informed latent variables, and \(\sigma_k^2\) the variance per predictor for the canonical coefficients.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code>getEnvironCor</code> ,<code><a href="getResidualCov.gllvm.html">getResidualCov.gllvm</a></code>, <code><a href="getResidualCor.gllvm.html">getResidualCor.gllvm</a></code>,.</p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Bert van der Veen</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Example with the spider dataset</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">eSpider</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">=</span> <span class="va">eSpider</span><span class="op">$</span><span class="va">abund</span><span class="op">[</span><span class="va">eSpider</span><span class="op">$</span><span class="va">nonNA</span>,<span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">X</span> <span class="op">=</span> <span class="va">eSpider</span><span class="op">$</span><span class="va">X</span><span class="op">[</span><span class="va">eSpider</span><span class="op">$</span><span class="va">nonNA</span>,<span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="gllvm.html">gllvm</a></span><span class="op">(</span><span class="va">y</span>, X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>, num.RR <span class="op">=</span> <span class="fl">2</span>, </span></span>
<span class="r-in"><span>            randomB <span class="op">=</span> <span class="st">"P"</span>, family <span class="op">=</span> <span class="st">"negative.binomial"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">envcov</span> <span class="op">&lt;-</span> <span class="fu">getEnvironCov</span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">envcov</span><span class="op">$</span><span class="va">trace.randomB</span></span></span>
<span class="r-in"><span><span class="co"># As proportion of variance in the model</span></span></span>
<span class="r-in"><span><span class="va">envcov</span><span class="op">$</span><span class="va">trace.randomB</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">envcov</span><span class="op">$</span><span class="va">trace.randomB</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jenni Niku, Wesley Brooks, Riki Herliansyah, Francis K.C. Hui, Pekka Korhonen, Sara Taskinen, Bert van der Veen, David I. Warton.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

