<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Phylogenetic random effects • gllvm</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Phylogenetic random effects">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gllvm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.4.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/vignette1.html">Analysing multivariate abundance data using gllvm</a>
    </li>
    <li>
      <a href="../articles/vignette2.html">Analysing high-dimensional microbial community data using gllvm</a>
    </li>
    <li>
      <a href="../articles/vignette3.html">Introduction to gllvm Part 1: Ordination</a>
    </li>
    <li>
      <a href="../articles/vignette4.html">Introduction to gllvm Part 2: Species correlations</a>
    </li>
    <li>
      <a href="../articles/vignette5.html">How to use the quadratic response model</a>
    </li>
    <li>
      <a href="../articles/vignette6.html">Ordination with predictors</a>
    </li>
    <li>
      <a href="../articles/vignette7.html">Phylogenetic random effects</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/JenniNiku/gllvm/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Phylogenetic random effects</h1>
                        <h4 data-toc-skip class="author">Bert van der
Veen</h4>
            
            <h4 data-toc-skip class="date">2024-08-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/JenniNiku/gllvm/blob/HEAD/vignettes/vignette7.Rmd" class="external-link"><code>vignettes/vignette7.Rmd</code></a></small>
      <div class="hidden name"><code>vignette7.Rmd</code></div>

    </div>

    
    
<p>This vignette is divided into two parts, the first part related to
models with environment covariates only, and the second part for models
that additionally incorporate trait covariates, so called “fourth
corner” models. This is for convenience, as the interface for fitting
fourth corner models slightly differs from the models without traits.
Both models are detailed in <span class="citation">van der Veen and
O’Hara</span>, and the fourth corner model in more detail in <span class="citation">Niku et al. (2021)</span>.</p>
<p><strong>For more information about fitting trait models with random
effects, see also vignette 1</strong>.</p>
<div class="section level2">
<h2 id="phylogenetically-structured-environmental-responses">Phylogenetically structured environmental responses<a class="anchor" aria-label="anchor" href="#phylogenetically-structured-environmental-responses"></a>
</h2>
<p>In this vignette we demonstrate how to fit models that incorporate
phylogenetic information into the random effects. For this, we make use
of an adjusted version of the familiar -formula interface <span class="citation">(Bates et al. 2015)</span>.</p>
<p>Here, we will use the data by <span class="citation">Abrego et al.
(n.d.)</span>. It includes information of 215 fungal species at 1666
<em>European beech</em> logs, and was analyzed by the original authors
using a similar model. We start by loading the data:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jenniniku.github.io/gllvm/" class="external-link">gllvm</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">fungi</span><span class="op">)</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">fungi</span><span class="op">$</span><span class="va">Y</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="va">fungi</span><span class="op">$</span><span class="va">X</span></span>
<span><span class="va">tree</span> <span class="op">&lt;-</span> <span class="va">fungi</span><span class="op">$</span><span class="va">tree</span> <span class="co"># the tree</span></span>
<span><span class="va">colMat</span> <span class="op">&lt;-</span> <span class="va">fungi</span><span class="op">$</span><span class="va">C</span> <span class="co"># e.g., from ape::vcv(tree)</span></span>
<span><span class="va">dist</span> <span class="op">&lt;-</span> <span class="va">fungi</span><span class="op">$</span><span class="va">dist</span> <span class="co"># e.g., from ape::cophenetic.phylo(tree)</span></span>
<span></span>
<span><span class="co"># Scale the predictors</span></span>
<span><span class="va">covs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DBH.CM"</span>,<span class="st">"AVERDP"</span>,<span class="st">"CONNECT10"</span>,<span class="st">"TEMPR"</span>,<span class="st">"PRECIP"</span>,<span class="st">"log.AREA"</span><span class="op">)</span></span>
<span><span class="va">X</span><span class="op">[</span>,<span class="va">covs</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span>, <span class="va">covs</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>The included version of the package does not contain all available
environmental covariates, only those used in the original analysis. This
includes diameter at breast height (DBH.CM), decay stage (AVERDP),
connectivity of the surrounding forest (CONNECT10), annual temperature
range, annual precipitation, and the logarithm of the reserve’s
area.</p>
<p>We can think of the model as having two covariance matrices: one with
correlation between covariate effects, and another that incorporates the
correlation between species due to the phylogeny. The former is
specified via the formula interface, the form of the latter is (more or
less) fixed at present.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">TMB</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/TMB/man/openmp.html" class="external-link">openmp</a></span><span class="op">(</span><span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span>, autopar <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># set parallel computation</span></span>
<span><span class="va">model1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Y</span>, X <span class="op">=</span> <span class="va">X</span>,</span>
<span>        formula <span class="op">=</span> <span class="op">~</span><span class="op">(</span><span class="va">DBH.CM</span> <span class="op">+</span> <span class="va">AVERDP</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">AVERDP</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="va">CONNECT10</span> <span class="op">+</span> <span class="va">TEMPR</span> <span class="op">+</span> <span class="va">PRECIP</span> <span class="op">+</span> <span class="va">log.AREA</span><span class="op">|</span><span class="fl">1</span><span class="op">)</span>, beta0com <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                     family <span class="op">=</span> <span class="st">"binomial"</span>, num.lv <span class="op">=</span> <span class="fl">0</span>, sd.errors <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                     studyDesign <span class="op">=</span> <span class="va">X</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"REGION"</span>, <span class="st">"RESERVE"</span><span class="op">)</span><span class="op">]</span>, row.eff <span class="op">=</span> <span class="op">~</span><span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">REGION</span><span class="op">/</span><span class="va">RESERVE</span><span class="op">)</span>,</span>
<span>                     colMat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">colMat</span>, dist <span class="op">=</span> <span class="va">dist</span><span class="op">)</span>, colMat.rho.struct <span class="op">=</span> <span class="st">"term"</span>, nn.colMat <span class="op">=</span> <span class="fl">10</span>,</span>
<span>        optim.method <span class="op">=</span> <span class="st">"L-BFGS-B"</span><span class="op">)</span></span></code></pre></div>
<p>Let’s walk through some of the specified arguments.</p>
<p>The first line enables parallel computation, to speed up model
fitting.</p>
<p>Note that an intercept term is included in the random effects, which
can be excluded by incorporating a zero in the formula term.
Correlations are included between covariates inside the brackets, so we
could have uncorrelated effects by including them all in separately
bracketed terms. We specify <code>num.lv = 0</code> for now, although we
could just as well include latent variables (e.g., we could fit a model
with phylogenetically structured random intercepts and a (un)constrained
ordination), and <code>beta0comm</code> to have a single (fixed)
intercept for the whole community (species-specific intercepts enter via
the random effects). <code>sd.errors</code> is here for convenience set
to false, as it can take a (much) longer time to calculate standard
errors than to fit the model, and we should really only calculate the
standard errors when we need them (e.g., for visualization). The
<code><a href="../reference/se.gllvm.html">gllvm::se.gllvm</a></code> function can post-hoc calculate the
standard errors, so that we do not need to refit the model.</p>
<p>The <code>studyDesign</code> matrix is specified to additionally
incorporated random intercepts for the nested study design. and a
formula <code>row.eff</code> to specify the random intercept structure.
The <code>colMat</code> term is how we pass the phylogenetic information
to the model, which is usually a list of length two, where one argument
is called <code>dist</code> and the other is the covariance matrix from
the tree. Note that these two matrices need to have the same column
names as <code>Y</code>. <code>nn.colMat</code> is the number of nearest
neighbours to consider for each species on the tree, which is fixed to
10 by default. Smaller numbers usually result in a faster fitting model,
but one that is potentially less accurate. <span class="citation">van
der Veen and O’Hara</span> showed that 10-15 neighbours is usually a
good choice, although fewer can also still lead to accurate estimates
for the phylogenetic signal. <code>colMat.rho.struct</code> has two
options, <code>single</code> fitting a model with the same phylogenetic
signal parameter for all covariates (default) and <code>term</code>
fitting a model with a phylogenetic signal parameter per covariate.
Finally, the last line changes the optimisation method to one that seems
to usually do well with this model type, and changes the starting values
of the random effect (which was needed to fit this model
succesfully).</p>
<p>After model fitting, the random effect estimates can be found in
<code>model1$params$Br</code>, and prediction errors can be extracted
with <code><a href="../reference/getPredictErr.gllvm.html">gllvm::getPredictErr</a></code>. This requires the standard
errors, so let’s calculate thosefirst:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calculate standard errors</span></span>
<span><span class="va">ses</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/se.gllvm.html">se.gllvm</a></span><span class="op">(</span><span class="va">model1</span><span class="op">)</span> <span class="co"># this can take a few minutes</span></span>
<span><span class="va">model1</span><span class="op">$</span><span class="va">sd</span> <span class="op">&lt;-</span> <span class="va">ses</span><span class="op">$</span><span class="va">sd</span></span>
<span><span class="va">model1</span><span class="op">$</span><span class="va">Hess</span> <span class="op">&lt;-</span> <span class="va">ses</span><span class="op">$</span><span class="va">Hess</span></span></code></pre></div>
<p>Here is some code to visualize the model results (from <span class="citation">van der Veen and O’Hara</span>):</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">model1</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">Br</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Intercept"</span>, <span class="st">"Deadwood size"</span>, <span class="st">"Decay stage"</span>, <span class="st">"Decay stage²"</span>, <span class="st">"Connectivity"</span>, <span class="st">"Temperature range"</span>, <span class="st">"Precipitation"</span>,<span class="st">"ln(Reserve area)"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># strike REs that are not significant</span></span>
<span><span class="va">PEs</span> <span class="op">&lt;-</span> <span class="fu">gllvm</span><span class="fu">::</span><span class="fu"><a href="../reference/getPredictErr.gllvm.html">getPredictErr</a></span><span class="op">(</span><span class="va">model1</span><span class="op">)</span></span>
<span><span class="va">PIs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>LI <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">model1</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">Br</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">PEs</span><span class="op">$</span><span class="va">Br</span><span class="op">*</span><span class="fl">1.96</span><span class="op">)</span>, UI <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">model1</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">Br</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">PEs</span><span class="op">$</span><span class="va">Br</span><span class="op">*</span><span class="fl">1.96</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">model1</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">Br</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">(</span><span class="va">PIs</span><span class="op">$</span><span class="va">LI</span><span class="op">&gt;</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">PIs</span><span class="op">$</span><span class="va">UI</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span><span class="va">PIs</span><span class="op">$</span><span class="va">LI</span><span class="op">&lt;</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">PIs</span><span class="op">$</span><span class="va">UI</span><span class="op">&lt;</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">&lt;-</span><span class="cn">NA</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/layout.html" class="external-link">layout</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>, respect <span class="op">=</span> <span class="cn">TRUE</span>, heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.25</span>,<span class="fl">1</span><span class="op">)</span>, widths<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="fl">1L</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">model1</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">model1</span><span class="op">$</span><span class="va">col.eff</span><span class="op">$</span><span class="va">spdr</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">model1</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">Br</span><span class="op">[</span>,<span class="va">tree</span><span class="op">$</span><span class="va">tip.label</span><span class="op">]</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html" class="external-link">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#E69F00"</span>,<span class="st">"white"</span>,<span class="st">"#009E73"</span><span class="op">)</span><span class="op">)</span><span class="op">(</span><span class="fl">28</span><span class="op">)</span>, axes<span class="op">=</span><span class="cn">FALSE</span>, ylim <span class="op">=</span> <span class="fl">0.5</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">model1</span><span class="op">$</span><span class="va">col.eff</span><span class="op">$</span><span class="va">spdr</span><span class="op">)</span><span class="op">)</span>,xlim<span class="op">=</span><span class="fl">0.5</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">model1</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">)</span>,xlab<span class="op">=</span><span class="cn">NA</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3.5</span>,<span class="fl">3.5</span>,by<span class="op">=</span><span class="fl">.25</span><span class="op">)</span>, ylab<span class="op">=</span><span class="cn">NA</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span>side<span class="op">=</span><span class="fl">1</span>, text<span class="op">=</span><span class="st">"Species-specific random effect"</span>,padj<span class="op">=</span><span class="fl">4</span>, cex <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">2</span>, at<span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">model1</span><span class="op">$</span><span class="va">col.eff</span><span class="op">$</span><span class="va">spdr</span><span class="op">)</span>, labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">model1</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">Br</span><span class="op">)</span><span class="op">)</span>,las<span class="op">=</span><span class="fl">1</span>, cex.axis <span class="op">=</span> <span class="fl">0.6</span>, lwd<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>xpd<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">model1</span><span class="op">$</span><span class="va">col.eff</span><span class="op">$</span><span class="va">spdr</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>,<span class="fl">0</span><span class="op">)</span>,y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">i</span>,<span class="va">i</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/emmanuelparadis/ape" class="external-link">ape</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tree</span>, show.tip.label <span class="op">=</span> <span class="cn">FALSE</span>, direction <span class="op">=</span> <span class="st">"downwards"</span>,xaxs<span class="op">=</span><span class="st">"i"</span><span class="op">)</span></span>
<span><span class="co"># caterpillar</span></span>
<span><span class="va">coefs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">model1</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">beta0</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="va">model1</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">B</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">model1</span><span class="op">$</span><span class="va">col.eff</span><span class="op">$</span><span class="va">spdr</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">sds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">model1</span><span class="op">$</span><span class="va">sd</span><span class="op">$</span><span class="va">beta0</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="va">model1</span><span class="op">$</span><span class="va">sd</span><span class="op">$</span><span class="va">B</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">model1</span><span class="op">$</span><span class="va">col.eff</span><span class="op">$</span><span class="va">spdr</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">CIs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>LI<span class="op">=</span><span class="va">coefs</span><span class="op">+</span><span class="va">sds</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fl">0.95</span><span class="op">)</span>, UI<span class="op">=</span><span class="va">coefs</span><span class="op">+</span><span class="va">sds</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="fl">0.95</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">coefs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Intercept"</span>, <span class="st">"Deadwood size"</span>, <span class="st">"Decay stage"</span>, <span class="st">"Decay stage²"</span>, <span class="st">"Connectivity"</span>, <span class="st">"Temperature range"</span>, <span class="st">"Precipitation"</span>, <span class="st">"ln(Reserve area)"</span><span class="op">)</span></span>
<span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="fl">8</span><span class="op">)</span></span>
<span><span class="va">cols</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">(</span><span class="va">CIs</span><span class="op">$</span><span class="va">LI</span><span class="op">&gt;</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">CIs</span><span class="op">$</span><span class="va">UI</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span><span class="va">CIs</span><span class="op">$</span><span class="va">LI</span><span class="op">&lt;</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">CIs</span><span class="op">$</span><span class="va">UI</span><span class="op">&lt;</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"grey"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">0.5</span>,<span class="fl">2</span>,<span class="fl">5</span><span class="op">)</span>, xpd<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">coefs</span>, y <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">coefs</span><span class="op">)</span>, yaxt<span class="op">=</span><span class="st">"n"</span>,ylab<span class="op">=</span><span class="st">""</span>, pch<span class="op">=</span><span class="st">"x"</span>, col <span class="op">=</span> <span class="va">cols</span>, xlab <span class="op">=</span> <span class="cn">NA</span>, cex.axis <span class="op">=</span> <span class="fl">0.6</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">coefs</span><span class="op">)</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">coefs</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span>side <span class="op">=</span> <span class="fl">1</span>, text <span class="op">=</span> <span class="st">"Community mean response"</span>, padj <span class="op">=</span> <span class="fl">4</span>, cex <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html" class="external-link">segments</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">CIs</span><span class="op">$</span><span class="va">LI</span>, y0 <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">coefs</span><span class="op">)</span>, x1 <span class="op">=</span> <span class="va">CIs</span><span class="op">$</span><span class="va">UI</span>, y1 <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">coefs</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">cols</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fl">0</span>, lty<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">4</span>, at <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">coefs</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">coefs</span><span class="op">)</span>, las <span class="op">=</span> <span class="fl">1</span>, cex.axis <span class="op">=</span> <span class="fl">0.6</span>,lwd<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette7_files/figure-html/bigplot-1.png" width="672" style="display: block; margin: auto;"></p>
<p>The random effects with a prediction interval including zero are
crossed out in the plot. The <code>getResidualCov</code> and
<code>getResidualCor</code> functions extract the residual covariance
and correlation matrix, respectively, for visualizing species
associations.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">corrplot</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html" class="external-link">corrplot</a></span><span class="op">(</span><span class="fu"><a href="../reference/getEnvironCov.gllvm.html">getEnvironCor</a></span><span class="op">(</span><span class="va">model1</span><span class="op">)</span>, </span>
<span>                   type <span class="op">=</span> <span class="st">"lower"</span>, diag <span class="op">=</span> <span class="cn">FALSE</span>, order <span class="op">=</span> <span class="st">"AOE"</span>,</span>
<span>                   tl.pos <span class="op">=</span> <span class="st">"n"</span>, addgrid.col<span class="op">=</span><span class="cn">NA</span>, col.lim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette7_files/figure-html/unnamed-chunk-5-1.png" width="480" style="display: block; margin: auto;"></p>
<p>The <code>randomCoefPlot</code> function constructs caterpillar plots
of species deviations from the community mean responses, which can be
extracted via the summary method, or found via <code>coef</code> and in
<code>model1$params$B</code>.</p>
<p>Arguments to control the VA approximation are <code>Ab.struct</code>
and <code>Ab.struct.rank</code>, for details see <span class="citation">van der Veen and O’Hara</span>. NOTE: Use
<code>Ab.struct = "CL1"</code> or <code>Ab.struct="CL2"</code> only in
parallel when using <code>TMB::openmp(.., autopar=TRUE)</code>. Without
TMB’s “automatic” parallelization feature, memory use is excessively and
your computer will probably run out of memory (for a moderately large
number of sites and species) so that your R session will crash.</p>
<!--(but, note that changing both of these options will likely cause a significant increase in memory use when combined with parallel computation).-->
<p>Finally, we can look at the summary information of the model:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## gllvm(y = Y, X = X, formula = ~(DBH.CM + AVERDP + I(AVERDP^2) + </span></span>
<span><span class="co">##     CONNECT10 + TEMPR + PRECIP + log.AREA | 1), family = "binomial", </span></span>
<span><span class="co">##     num.lv = 0, studyDesign = X[, c("REGION", "RESERVE")], colMat = list(colMat, </span></span>
<span><span class="co">##         dist = dist), colMat.rho.struct = "term", row.eff = ~(1 | </span></span>
<span><span class="co">##         REGION/RESERVE), sd.errors = FALSE, beta0com = TRUE, </span></span>
<span><span class="co">##     nn.colMat = 10, optim.method = "L-BFGS-B")</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Family:  binomial </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## AIC:  103278.3 AICc:  103278.3 BIC:  103860.9 LL:  -51585 df:  54 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Informed LVs:  0 </span></span>
<span><span class="co">## Constrained LVs:  0 </span></span>
<span><span class="co">## Unconstrained LVs:  0 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Formula:  ~(DBH.CM + AVERDP + I(AVERDP^2) + CONNECT10 + TEMPR + PRECIP + log.AREA | 1) </span></span>
<span><span class="co">## LV formula:  ~ 0 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Random effects:</span></span>
<span><span class="co">##  Name        Signal Variance Std.Dev Corr                                   </span></span>
<span><span class="co">##  Intercept   0.0571 0.5971   0.7727                                         </span></span>
<span><span class="co">##  DBH.CM      0.0368 0.0041   0.0644   0.8787                                </span></span>
<span><span class="co">##  AVERDP      0.9959 0.4360   0.6603   0.0933 -0.1034                        </span></span>
<span><span class="co">##  I.AVERDP.2. 0.7827 0.0106   0.1030  -0.5585 -0.5000 -0.5708                </span></span>
<span><span class="co">##  CONNECT10   0.6551 0.0579   0.2405  -0.1770 -0.1488  0.2429 -0.0432        </span></span>
<span><span class="co">##  TEMPR       0.0091 0.0459   0.2142  -0.1729 -0.2804 -0.0987  0.6014  0.3213</span></span>
<span><span class="co">##  PRECIP      0.6758 0.0588   0.2425   0.2919  0.5359 -0.5207  0.0857 -0.6608</span></span>
<span><span class="co">##  log.AREA    0.3373 0.0226   0.1502  -0.1361 -0.0902  0.1447 -0.3424  0.5081</span></span>
<span><span class="co">##                  </span></span>
<span><span class="co">##                  </span></span>
<span><span class="co">##                  </span></span>
<span><span class="co">##                  </span></span>
<span><span class="co">##                  </span></span>
<span><span class="co">##                  </span></span>
<span><span class="co">##                  </span></span>
<span><span class="co">##  -0.1858         </span></span>
<span><span class="co">##  -0.5562 -0.5377 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients predictors:</span></span>
<span><span class="co">##               Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">## Intercept   -2.1291688  0.3170808  -6.715 1.88e-11 ***</span></span>
<span><span class="co">## DBH.CM       0.0932309  0.0277290   3.362 0.000773 ***</span></span>
<span><span class="co">## AVERDP      -0.1291142  0.2295171  -0.563 0.573743    </span></span>
<span><span class="co">## I.AVERDP.2. -0.1389372  0.0410986  -3.381 0.000723 ***</span></span>
<span><span class="co">## CONNECT10   -0.0747686  0.0993708  -0.752 0.451798    </span></span>
<span><span class="co">## TEMPR        0.0008955  0.0985526   0.009 0.992750    </span></span>
<span><span class="co">## PRECIP      -0.0215561  0.0994446  -0.217 0.828392    </span></span>
<span><span class="co">## log.AREA     0.0655261  0.0679750   0.964 0.335059    </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre>
<p>which gives us an overview of the community mean responses, as well
as the variance and correlation of random effects, and the phylogenetic
signal parameter in the column <code>signal</code>. This parameter
ranges between zero and one, at zero the species responses are not
phylogenetically structured, and at one they are fully phylogenetically
structured.</p>
<!-- The `confint` function returns (approximate asysmptotic) confidence intervals for all parameters, including the phylogenetic signal. We might instead want to use TMB's functionality for calculating a profile confidence interval instead (since it will be more accurate and appropriate, though it tends to take quite a lot of time) for the phylogenetic signal parameters: -->
<!-- ```{r, cache = TRUE, message=FALSE, warning=FALSE, echo = -6, eval = FALSE} -->
<!-- profs <- list() -->
<!-- # This may take a few minutes -->
<!-- for(i in 1:ncol(model1$col.eff$spdr)){ -->
<!--   profs[[i]] <- TMB::tmbprofile(model1$TMBfn, name = tail(which(names(model1$TMBfn$par)=="sigmaB"), ncol(model1$col.eff$spdr))[i], h = 1, parm.range = c(-12,3.5)) -->
<!-- } -->
<!-- ``` -->
<!-- ```{r, echo = FALSE} -->
<!-- load("model1profs.RData") -->
<!-- library(TMB) -->
<!-- ``` -->
<!-- ```{r, warning=FALSE, error=FALSE} -->
<!-- for(i in 1:length(profs)){ -->
<!--   profs[[i]][,1] <- exp(-exp(profs[[i]][,1])) -->
<!--   plot(profs[[i]][!apply(profs[[i]],1,anyNA),]) -->
<!-- } -->
<!-- ``` -->
</div>
<div class="section level2">
<h2 id="phylogenetic-fourth-corner-model">Phylogenetic fourth corner model<a class="anchor" aria-label="anchor" href="#phylogenetic-fourth-corner-model"></a>
</h2>
<p>The fourth corner model extends the previous model with functional
traits. The interface is still a little difference, so that correlation
between random effects are always included. Otherwise the tools are
similar, so we just present some example code here for fitting such a
model, but do not discuss it further (see other vignettes in the gllvm
R-package for discussion of the fourth corner model).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TR</span> <span class="op">&lt;-</span> <span class="va">fungi</span><span class="op">$</span><span class="va">TR</span> <span class="co"># the functional traits</span></span>
<span></span>
<span><span class="va">model2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Y</span>, X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>int <span class="op">=</span> <span class="fl">1</span>, <span class="va">X</span><span class="op">)</span>, TR <span class="op">=</span> <span class="va">TR</span>,</span>
<span>                     formula <span class="op">=</span> <span class="op">~</span><span class="va">DBH.CM</span> <span class="op">+</span> <span class="va">AVERDP</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">AVERDP</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="va">CONNECT10</span> <span class="op">+</span> </span>
<span>  <span class="va">TEMPR</span> <span class="op">+</span> <span class="va">PRECIP</span> <span class="op">+</span> <span class="va">log.AREA</span> <span class="op">+</span> <span class="op">(</span><span class="va">DBH.CM</span> <span class="op">+</span> <span class="va">AVERDP</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">AVERDP</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="va">CONNECT10</span> <span class="op">+</span> <span class="va">TEMPR</span> <span class="op">+</span> <span class="va">PRECIP</span> <span class="op">+</span> <span class="va">log.AREA</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="va">PC1.1</span> <span class="op">+</span> <span class="va">PC1.2</span> <span class="op">+</span> <span class="va">PC1.3</span><span class="op">)</span>, </span>
<span>                      family <span class="op">=</span> <span class="st">"binomial"</span>, num.lv <span class="op">=</span> <span class="fl">0</span>, studyDesign <span class="op">=</span> <span class="va">X</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"REGION"</span>, <span class="st">"RESERVE"</span><span class="op">)</span><span class="op">]</span>, </span>
<span>                      colMat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">C</span>, dist <span class="op">=</span> <span class="va">dist</span><span class="op">)</span>, </span>
<span>                      colMat.rho.struct <span class="op">=</span> <span class="st">"term"</span>, row.eff <span class="op">=</span> <span class="op">~</span><span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">REGION</span><span class="op">/</span><span class="va">RESERVE</span><span class="op">)</span>, sd.errors <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                      randomX <span class="op">=</span> <span class="op">~</span><span class="va">int</span> <span class="op">+</span> <span class="va">DBH.CM</span> <span class="op">+</span> <span class="va">AVERDP</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">AVERDP</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="va">CONNECT10</span> <span class="op">+</span> <span class="va">TEMPR</span> <span class="op">+</span> <span class="va">PRECIP</span> <span class="op">+</span> <span class="va">log.AREA</span>, </span>
<span>                      beta0com <span class="op">=</span> <span class="cn">TRUE</span>, Ab.struct <span class="op">=</span> <span class="st">"MNunstructured"</span>, nn.colMat <span class="op">=</span> <span class="fl">10</span>, max.iter <span class="op">=</span> <span class="fl">20000</span>, maxit <span class="op">=</span> <span class="fl">20000</span>, optim.method <span class="op">=</span> <span class="st">"L-BFGS-B"</span>, </span>
<span>randomX.start <span class="op">=</span> <span class="st">"res"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Abrego2022a" class="csl-entry">
Abrego, N., C. Bässler, M. Christensen, and J. Heilmann-Clausen. n.d.
<span>“Data and Code from: Traits and Phylogenies Module the
Environmental Responses of Wood-Inhabiting Fungal Communities Across
Spatial Scales [Dataset].”</span> Dryad. https://doi.org/<a href="https://doi.org/10.5061/dryad.t76hdr82r" class="external-link">https://doi.org/10.5061/dryad.t76hdr82r</a>.
</div>
<div id="ref-lme4" class="csl-entry">
Bates, D., M. Mächler, B. Bolker, and S. Walker. 2015. <span>“Fitting
Linear Mixed-Effects Models Using Lme4”</span> 67: 1–48.
</div>
<div id="ref-Niku2021" class="csl-entry">
Niku, J., F.K.C. Hui, S. Taskinen, and D.I. Warton. 2021.
<span>“Analyzing Environmental-Trait Interactions in Ecological
Communities with Fourth-Corner Latent Variable Models”</span> 32.6:
e2683.
</div>
<div id="ref-vanderVeen2024" class="csl-entry">
Veen, B. van der, and R.B. O’Hara. <span>“Fast Fitting of Phylogenetic
Mixed Effects Models.”</span> https://doi.org/<a href="https://www.arxiv.org/abs/2408.05333" class="external-link">https://www.arxiv.org/abs/2408.05333</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jenni Niku, Wesley Brooks, Riki Herliansyah, Francis K.C. Hui, Pekka Korhonen, Sara Taskinen, Bert van der Veen, David I. Warton.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
