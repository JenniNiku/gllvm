<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Analysing multivariate abundance data using gllvm ‚Ä¢ gllvm</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Analysing multivariate abundance data using gllvm">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gllvm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.0.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/vignette1.html">Analysing multivariate abundance data using gllvm</a>
    </li>
    <li>
      <a href="../articles/vignette2.html">Analysing high-dimensional microbial community data using gllvm</a>
    </li>
    <li>
      <a href="../articles/vignette3.html">Introduction to gllvm Part 1: Ordination</a>
    </li>
    <li>
      <a href="../articles/vignette4.html">Introduction to gllvm Part 2: Species correlations</a>
    </li>
    <li>
      <a href="../articles/vignette5.html">How to use the quadratic response model</a>
    </li>
    <li>
      <a href="../articles/vignette6.html">Ordination with predictors</a>
    </li>
    <li>
      <a href="../articles/vignette7.html">Phylogenetic random effects</a>
    </li>
    <li>
      <a href="../articles/vignette8.html">Analysing sparse ecological percent cover data using gllvm</a>
    </li>
    <li>
      <a href="../articles/vignette9.html">Correlation structures for latent variables and row effects</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/JenniNiku/gllvm/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Analysing multivariate abundance data using
gllvm</h1>
                        <h4 data-toc-skip class="author">Jenni Niku</h4>
            
            <h4 data-toc-skip class="date">2025-07-24</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/JenniNiku/gllvm/blob/HEAD/vignettes/vignette1.Rmd" class="external-link"><code>vignettes/vignette1.Rmd</code></a></small>
      <div class="hidden name"><code>vignette1.Rmd</code></div>

    </div>

    
    
<p>This document illustrates the main features and functionality of the
<strong>gllvm</strong> package, developed for the analysis of
multivariate abundance data. Examples are provided in order to show how
generalized linear latent variable models (GLLVM) can be applied to
data. The functionality of the package is described in detail in <span class="citation">Niku et al. (2019)</span>.</p>
<p>Multivariate abundance data, consisting of observations of multiple
interacting species from a set of samples, are often collected in
ecological studies to characterize a community or assemblage of
organisms. The term ‚Äúabundance‚Äù is taken here to mean counts,
presence-absence records, biomass data or any other measure of the
extent to which a species may be present at a site.</p>
<p>GLLVM extends the basic generalized linear model to multivariate data
using a factor analytic approach, <em>i.e.</em> incorporating a small
number of latent variables for each site accompanied by species specific
factor loadings to model correlations between responses. These latent
variables have a natural interpretation as ordination axes, but with
additional capacity, <em>e.g.</em> predicting new values, controlling
for known environmental variables, using standard model selection tools
to choose number of ordination axes.</p>
<div class="section level3">
<h3 id="generalized-linear-latent-variable-models">Generalized linear latent variable models<a class="anchor" aria-label="anchor" href="#generalized-linear-latent-variable-models"></a>
</h3>
<p>A multivariate abundance dataset can be defined by a matrix of
abundances, with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
rows (usually sites or samples) and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>m</mi><annotation encoding="application/x-tex">m</annotation></semantics></math>
columns of responses (usually species). Denote the abundance of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>th
species at the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>th
site as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">y_{ij}</annotation></semantics></math>.
A set of k environmental variables, or experimental treatments, may also
be recorded at each site and stored in the vector
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ùê±</mi><mi>i</mi></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mrow><mi>i</mi><mn>1</mn></mrow></msub><mo>,</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>,</mo><msub><mi>x</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\boldsymbol{x}_i = (x_{i1}, ..., x_{ik})</annotation></semantics></math>.
A GLLVM regresses the mean abundance
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\mu_{ij}</annotation></semantics></math>
against environmental variables and a vector of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo>&lt;</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">d&lt;m</annotation></semantics></math>
latent variables,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ùêÆ</mi><mi>i</mi></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>u</mi><mrow><mi>i</mi><mn>1</mn></mrow></msub><mo>,</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>,</mo><msub><mi>u</mi><mrow><mi>i</mi><mi>d</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>‚Ä≤</mi></mrow><annotation encoding="application/x-tex">\boldsymbol{u}_i = (u_{i1}, ..., u_{id})'</annotation></semantics></math>:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>Œ∑</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><msub><mi>Œ±</mi><mi>i</mi></msub><mo>+</mo><msub><mi>Œ≤</mi><mrow><mn>0</mn><mi>j</mi></mrow></msub><mo>+</mo><msub><mi>ùê±</mi><mi>i</mi></msub><mi>‚Ä≤</mi><msub><mi>ùõÉ</mi><mi>j</mi></msub><mo>+</mo><msub><mi>ùêÆ</mi><mi>i</mi></msub><mi>‚Ä≤</mi><msub><mi>ùõâ</mi><mi>j</mi></msub><mo>,</mo></mrow><annotation encoding="application/x-tex">g(\mu_{ij}) = \eta_{ij} = \alpha_i + \beta_{0j} + \boldsymbol{x}_i'\boldsymbol{\beta}_j + \boldsymbol{u}_i'\boldsymbol{\theta}_j,</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ùõÉ</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\boldsymbol{\beta}_j</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ùõâ</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\boldsymbol{\theta}_j</annotation></semantics></math>
are vectors of species specific coefficients related to the covariates
and latent variables, respectively. The latent variables
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ùêÆ</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\boldsymbol{u}_i</annotation></semantics></math>
can be thought of as unmeasured environmental variables, or as
ordination scores, capturing the main axes of covariation of abundance
(after controlling for observed predictors
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ùê±</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\boldsymbol{x}_i</annotation></semantics></math>).
We assume these latent variables are independent across sites and
standard normally distributed. The parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ≤</mi><mrow><mn>0</mn><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\beta_{0j}</annotation></semantics></math>
are species specific intercepts, while
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ±</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\alpha_i</annotation></semantics></math>
are optional community level row effects which can be chosen as either
fixed or random effects
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œ±</mi><mi>i</mi></msub><mo>‚àº</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>;</mo><msup><mi>œÉ</mi><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">\alpha_i \sim N(0; \sigma^2))</annotation></semantics></math>.
If community level row effects for each sample
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ±</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\alpha_i</annotation></semantics></math>
are included, all other terms in the model can be subsequently
interpreted as modelling relative abundance or compositional effects
(Hui et al., 2015).</p>
<p>If
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>q</mi><annotation encoding="application/x-tex">q</annotation></semantics></math>
trait covariates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ùê≠</mi><mi>j</mi></msub><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mrow><mi>i</mi><mn>1</mn></mrow></msub><mo>,</mo><mi>‚Ä¶</mi><mo>,</mo><msub><mi>t</mi><mrow><mi>i</mi><mi>q</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>‚ä§</mi></msup></mrow><annotation encoding="application/x-tex">\boldsymbol{t}_j=(t_{i1}, \dots,t_{iq})^\top</annotation></semantics></math>
are also recorded, we can use them to help explain inter-specific
variation in environmental response. This leads to an extension of the
so-called ‚Äúfourth corner model‚Äù where multivariate abundance is
regressed against a function of traits and environment, and the
environment-trait interactions represents the fourth corner association
between traits and environment. We also include species-specific random
slopes for environmental covariates in order to take into account the
inters-pecific variation in responses that is not explained by the
covariates. The associated fourth corner GLLVM then has mean model:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>Œ∑</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><msub><mi>Œ±</mi><mi>i</mi></msub><mo>+</mo><msub><mi>Œ≤</mi><mrow><mn>0</mn><mi>j</mi></mrow></msub><mo>+</mo><msubsup><mi>ùê±</mi><mi>i</mi><mi>‚ä§</mi></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>ùõÉ</mi><mi>e</mi></msub><mo>+</mo><msub><mi>ùêõ</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>ùê≠</mi><mi>j</mi></msub><mo>‚äó</mo><msub><mi>ùê±</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>‚ä§</mi></msup><msub><mi>ùõÉ</mi><mi>I</mi></msub><mo>+</mo><msubsup><mi>ùêÆ</mi><mi>i</mi><mi>‚ä§</mi></msubsup><msub><mi>ùõâ</mi><mi>j</mi></msub><mo>,</mo></mrow><annotation encoding="application/x-tex">g(\mu_{ij}) = \eta_{ij}= \alpha_i + \beta_{0j} + \boldsymbol x^\top_i (\boldsymbol\beta_e + \boldsymbol b_j) + (\boldsymbol t_j \otimes \boldsymbol x_i)^\top \boldsymbol \beta_I + \boldsymbol u_i^\top\boldsymbol\theta_j,</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ùõÉ</mi><mi>e</mi></msub><annotation encoding="application/x-tex">\boldsymbol\beta_e</annotation></semantics></math>
is a vector of main effects for environmental covariates, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ùõÉ</mi><mi>I</mi></msub><annotation encoding="application/x-tex">\boldsymbol\beta_I</annotation></semantics></math>
are the fourth corner coefficients. A main effect for traits is not
included, because main effects on abundance across species are absorbed
by the intercept term
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ≤</mi><mrow><mn>0</mn><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\beta_{0j}</annotation></semantics></math>.
This model assumes that inter-specific variation in response to
covariates is mediated by species and random slopes, which reduces the
number of parameters related to covariates.</p>
<p>A difficulty fitting the GLLVM is that the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ùêÆ</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\boldsymbol{u}_i</annotation></semantics></math>‚Äôs
are unobserved and we must integrate over their possible values.
Specifically, the log-likelihood function we wish to maximize has the
form <span class="math display">$$l(\boldsymbol\Psi)=\sum_{i=1}^n
\log(f(y_{ij},\boldsymbol\Psi))=\sum_{i=1}^n \log\left(\int_{{\rm
I\!R}^{d}} \prod_{j=1}^m f(y_{ij}|\boldsymbol u_i;\boldsymbol\Psi)
f(\boldsymbol{u}_i) d\boldsymbol{u}_i,\right),$$</span></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùõô</mi><annotation encoding="application/x-tex">\boldsymbol\psi</annotation></semantics></math>
includes all model parameters. In this expression we have assumed
abundances are independent across sites and any correlation across
responses is captured by the latent variables
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ùêÆ</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\boldsymbol u_i</annotation></semantics></math>.
Thus conditional on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ùêÆ</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\boldsymbol u_i</annotation></semantics></math>,
the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">y_{ij}</annotation></semantics></math>
are independent of each other within sites.</p>
<p>The <strong>gllvm</strong> package overcomes these computational
problems using three key innovations:</p>
<ul>
<li><p>maximizing an approximation to the log-likelihood that is (almost
completely) closed form. We provide two ways to do this ‚Äì using Gaussian
variational approximations for overdispersed counts, binary and ordinal
responses, or using Laplace approximations for other exponential family
distributions when a fully closed form variational approximation cannot
be obtained <em>e.g.</em> biomass data can be modelled by the Tweedie
distribution.</p></li>
<li><p>Parameter estimation makes use of automatic differentiation
software in C++ to accelerate computation times, via the interface
provided by the R package TMB.</p></li>
<li><p>Careful choice of starting values. In particular, we use a factor
analysis on Dunn-Smyth residuals to obtain starting values close to the
anticipated solution, optionally, with jittering to check the
sensitivity of the approach.</p></li>
</ul>
<p>In the next examples we illustrate the usage of the gllvm package
using <code>antTraits</code> data from the <code>mvabund</code> package.
The data consists of counts of 41 ant species measured at 30 sites
across south-east Australia, along with records of five environmental
variables and five trait variables for each species. The package and the
data can be loaded as follows.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mvabund</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jenniniku.github.io/gllvm/" class="external-link">gllvm</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: TMB</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'gllvm'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:mvabund':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     coefplot</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     simulate</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">antTraits</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">antTraits</span><span class="op">$</span><span class="va">abund</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">antTraits</span><span class="op">$</span><span class="va">env</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">TR</span> <span class="op">&lt;-</span> <span class="va">antTraits</span><span class="op">$</span><span class="va">traits</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="data-input">Data input<a class="anchor" aria-label="anchor" href="#data-input"></a>
</h3>
<p>Main function of the <strong>gllvm</strong> package is
<code><a href="../reference/gllvm.html">gllvm()</a></code>, which can be used to fit GLLVMs for multivariate
data with the most important arguments listed in the following:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span>y <span class="op">=</span> <span class="cn">NULL</span>, X <span class="op">=</span> <span class="cn">NULL</span>, TR <span class="op">=</span> <span class="cn">NULL</span>, data <span class="op">=</span> <span class="cn">NULL</span>, formula <span class="op">=</span> <span class="cn">NULL</span>, num.lv <span class="op">=</span> <span class="fl">2</span>, <span class="va">family</span>, </span>
<span>      method <span class="op">=</span> <span class="st">"VA"</span>, row.eff <span class="op">=</span> <span class="cn">FALSE</span>, offset <span class="op">=</span> <span class="cn">NULL</span>, Power <span class="op">=</span> <span class="fl">1.5</span>, starting.val <span class="op">=</span> <span class="st">"res"</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
<p>Data input can be specified using the ‚Äúwide format‚Äù matrices via
<code>y</code>, <code>X</code> and <code>TR</code> arguments.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Model without predictors:</span></span>
<span><span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span><span class="va">y</span>, family <span class="op">=</span> <span class="st">"negative.binomial"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Model where environmental variables, that is, all variables in X are included:</span></span>
<span><span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span>, family <span class="op">=</span> <span class="st">"negative.binomial"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fourth corner model, where all main effects for environmental variables in X and</span></span>
<span><span class="co"># all interactions between variables in X and variables in TR are included:</span></span>
<span><span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span>, <span class="va">TR</span>, family <span class="op">=</span> <span class="st">"negative.binomial"</span><span class="op">)</span></span></code></pre></div>
<p>An alternative way is to use the long format via <code>data</code>
argument along with <code>formula</code>. Notice that
<code>formula</code> can also be used for model specification when data
is given in wide format. In the following lines the ant data is
re-organised to a long format.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/reshape.html" class="external-link">reshape</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span><span class="op">)</span><span class="op">)</span>, direction <span class="op">=</span> <span class="st">"long"</span>, varying <span class="op">=</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, v.names <span class="op">=</span> <span class="st">"y"</span>, timevar <span class="op">=</span> <span class="st">"sp"</span><span class="op">)</span></span>
<span><span class="va">TR2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>sp <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">41</span>, <span class="va">TR</span><span class="op">)</span></span>
<span><span class="va">datalong</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">yX</span>, <span class="va">TR2</span>, by <span class="op">=</span> <span class="st">"sp"</span><span class="op">)</span></span>
<span><span class="va">datalong</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="op">]</span></span>
<span><span class="co">#&gt;   sp Bare.ground Canopy.cover Shrub.cover Volume.lying.CWD Feral.mammal.dung y</span></span>
<span><span class="co">#&gt; 1  1  -0.3926017    0.2290869  -0.5748133        0.4373291        -0.1755352 0</span></span>
<span><span class="co">#&gt; 2  1  -0.8007744   -0.4475411  -0.8053533       -0.2309758         1.5171255 0</span></span>
<span><span class="co">#&gt; 3  1  -0.3585873   -0.4475411   2.9293959       -0.3609125        -0.9278288 0</span></span>
<span><span class="co">#&gt;   id Femur.length No.spines Pilosity Polymorphism Webers.length</span></span>
<span><span class="co">#&gt; 1  1   -0.3827814         0        2            1      1.094225</span></span>
<span><span class="co">#&gt; 2  2   -0.3827814         0        2            1      1.094225</span></span>
<span><span class="co">#&gt; 3  3   -0.3827814         0        2            1      1.094225</span></span></code></pre></div>
<p>The model can then be fitted as</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Model without predictors:</span></span>
<span><span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">datalong</span>, family <span class="op">=</span> <span class="st">"negative.binomial"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Model with environmental variables Bare.ground and Shrub.cover as predictors</span></span>
<span><span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="op">(</span><span class="va">Bare.ground</span> <span class="op">+</span> <span class="va">Shrub.cover</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">datalong</span>,  </span>
<span>      family <span class="op">=</span> <span class="st">"negative.binomial"</span><span class="op">)</span></span></code></pre></div>
<p>The number of latent variables can be defined using the argument
<code>num.lv</code>. The default number of latent variables is two.
Other important arguments in the <code>gllvm</code> call are
<code>row.eff</code> for defining the type of row effects (none, fixed
or random, or multiple and/or sructured via formula),
<code>offset</code> for potential inclusion of offsets,
<code>Power</code> for defining the power parameter of the Tweedie
distribution and <code>starting.val</code> for judicious choice of
starting values for the latent variables.</p>
<p>List of available distributions with the mean,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">E(y_{ij})</annotation></semantics></math>,
and mean-variance,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">V(\mu_{ij})</annotation></semantics></math>,
functions, estimation methods and link functions for various response
types are in the table below.</p>
<table class="table">
<colgroup>
<col width="15%">
<col width="20%">
<col width="11%">
<col width="11%">
<col width="40%">
</colgroup>
<thead><tr class="header">
<th>Response</th>
<th align="center">Distribution</th>
<th align="left">Method</th>
<th align="left">Link</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Counts</td>
<td align="center">Poisson</td>
<td align="left">VA/LA</td>
<td align="left">log</td>
<td align="left">
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">E(y_{ij}) = \mu_{ij}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">V(\mu_{ij})=\mu_{ij}</annotation></semantics></math>
</td>
</tr>
<tr class="even">
<td></td>
<td align="center">NB</td>
<td align="left">VA/LA</td>
<td align="left">log</td>
<td align="left">
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">E(y_{ij}) = \mu_{ij}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>+</mo><msub><mi>œï</mi><mi>j</mi></msub><msubsup><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">V(\mu_{ij})=\mu_{ij}+\phi_j\mu_{ij}^2</annotation></semantics></math>,</td>
</tr>
<tr class="odd">
<td></td>
<td align="center"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left">where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>œï</mi><mi>j</mi></msub><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\phi_j&gt;0</annotation></semantics></math>
is a dispersion parameter</td>
</tr>
<tr class="even">
<td></td>
<td align="center">ZIP</td>
<td align="left">VA/LA</td>
<td align="left">log</td>
<td align="left">
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>‚àí</mo><msub><mi>p</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">E(y_{ij}) = (1-p_j)\mu_{ij}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>p</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">P(y_{ij}=0)=p_j</annotation></semantics></math>,</td>
</tr>
<tr class="odd">
<td></td>
<td align="center"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>‚àí</mo><msub><mi>p</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>+</mo><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><msub><mi>p</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">V(\mu_{ij}) = \mu_{ij}(1-p_j) (1+\mu_{ij}p_j)</annotation></semantics></math></td>
</tr>
<tr class="even">
<td></td>
<td align="center">ZINB</td>
<td align="left">VA/LA</td>
<td align="left">log</td>
<td align="left">
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>‚àí</mo><msub><mi>p</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">E(y_{ij}) = (1-p_j)\mu_{ij}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>p</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">P(y_{ij}=0)=p_j</annotation></semantics></math>,</td>
</tr>
<tr class="odd">
<td></td>
<td align="center"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>‚àí</mo><msub><mi>p</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>+</mo><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>p</mi><mi>j</mi></msub><mo>+</mo><msub><mi>œï</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">V(\mu_{ij}) = \mu_{ij}(1-p_j)(1+\mu_{ij}(p_j+\phi_j))</annotation></semantics></math></td>
</tr>
<tr class="even">
<td></td>
<td align="center">binomial</td>
<td align="left">VA/LA</td>
<td align="left">probit/cloglog</td>
<td align="left">
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>N</mi><mi>j</mi></msub><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">E(y_{ij}) = N_j\mu_{ij}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>N</mi><mi>j</mi></msub><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>‚àí</mo><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">V(\mu_{ij}) = N_j\mu_{ij}(1-\mu_{ij})</annotation></semantics></math>
</td>
</tr>
<tr class="odd">
<td></td>
<td align="center">binomial</td>
<td align="left">VA/EVA/LA</td>
<td align="left">logit/cloglog</td>
<td align="left"></td>
</tr>
<tr class="even">
<td>zero-inflated</td>
<td align="center">ZIB</td>
<td align="left">VA/LA</td>
<td align="left">probit/logit/cloglog</td>
<td align="left">
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>‚àí</mo><msub><mi>p</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>N</mi><mi>j</mi></msub><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">E(y_{ij}) = (1-p_j)N_j\mu_{ij}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>N</mi><mi>j</mi></msub><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>‚àí</mo><msub><mi>p</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>+</mo><msub><mi>N</mi><mi>j</mi></msub><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><msub><mi>p</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">V(\mu_{ij}) = N_j\mu_{ij}(1-p_j) (1+N_j\mu_{ij}p_j)</annotation></semantics></math>
</td>
</tr>
<tr class="odd">
<td></td>
<td align="center">ZIB</td>
<td align="left">VA/EVA/LA</td>
<td align="left">logit</td>
<td align="left"></td>
</tr>
<tr class="even">
<td>zero/N-inflated</td>
<td align="center">ZIB</td>
<td align="left">VA/LA</td>
<td align="left">probit/logit/cloglog</td>
<td align="left">
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msubsup><mi>p</mi><mi>j</mi><mi>N</mi></msubsup><msub><mi>N</mi><mi>j</mi></msub><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>‚àí</mo><msubsup><mi>p</mi><mi>j</mi><mn>0</mn></msubsup><mo>‚àí</mo><msubsup><mi>p</mi><mi>j</mi><mi>N</mi></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>N</mi><mi>j</mi></msub><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">E(y_{ij}) = p_j^N N_j + (1-p^0_j-p_j^N)N_j\mu_{ij}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msubsup><mi>p</mi><mi>j</mi><mi>N</mi></msubsup><msubsup><mi>N</mi><mi>j</mi><mn>2</mn></msubsup><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>‚àí</mo><msubsup><mi>p</mi><mi>j</mi><mn>0</mn></msubsup><mo>‚àí</mo><msup><mi>p</mi><msub><mi>N</mi><mi>j</mi></msub></msup><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>N</mi><mi>j</mi></msub><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>‚àí</mo><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>+</mo><msub><mi>N</mi><mi>j</mi></msub><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><mi>E</mi><msup><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>Y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">]</mo></mrow><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">V(\mu_{ij}) = p_j^N N_j^2 + (1-p_j^0-p^{N_j}) N_j\mu_{ij} (1-\mu_{ij}+N_j\mu_{ij})-E[Y_{ij}]^2</annotation></semantics></math>
</td>
</tr>
<tr class="odd">
<td>Binary</td>
<td align="center">Bernoulli</td>
<td align="left">EVA/VA/LA</td>
<td align="left">probit</td>
<td align="left">
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">E(y_{ij}) = \mu_{ij}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>‚àí</mo><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">V(\mu_{ij}) = \mu_{ij}(1-\mu_{ij})</annotation></semantics></math>
</td>
</tr>
<tr class="even">
<td></td>
<td align="center"></td>
<td align="left">EVA/LA</td>
<td align="left">logit</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td>Biomass</td>
<td align="center">Tweedie</td>
<td align="left">EVA/VA/LA</td>
<td align="left">log</td>
<td align="left">
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">E(y_{ij}) = \mu_{ij}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>œï</mi><mi>j</mi></msub><msubsup><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow><mi>ŒΩ</mi></msubsup></mrow><annotation encoding="application/x-tex">V(\mu_{ij}) = \phi_j\mu_{ij}^\nu</annotation></semantics></math>,</td>
</tr>
<tr class="even">
<td></td>
<td align="center"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left">where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>&lt;</mo><mi>ŒΩ</mi><mo>&lt;</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">1&lt;\nu&lt;2</annotation></semantics></math>
is a power parameter and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>œï</mi><mi>j</mi></msub><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\phi_j&gt;0</annotation></semantics></math>
is a dispersion parameter</td>
</tr>
<tr class="odd">
<td>Ordinal</td>
<td align="center">Multinomial</td>
<td align="left">VA</td>
<td align="left">probit/logit</td>
<td align="left">Cumulative probit/logit model</td>
</tr>
<tr class="even">
<td>Normal</td>
<td align="center">Gaussian</td>
<td align="left">VA/LA</td>
<td align="left">identity</td>
<td align="left">
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">E(y_{ij}) = \mu_{ij}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msubsup><mi>œï</mi><mi>j</mi><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">V(y_{ij}) = \phi_j^2</annotation></semantics></math>
</td>
</tr>
<tr class="odd">
<td>Positive continuous</td>
<td align="center">Gamma</td>
<td align="left">VA/LA</td>
<td align="left">log</td>
<td align="left">
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">E(y_{ij}) = \mu_{ij}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msubsup><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow><mn>2</mn></msubsup><mi>/</mi><msub><mi>œï</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">V(y_{ij}) = \mu_{ij}^2/\phi_j</annotation></semantics></math>
</td>
</tr>
<tr class="even">
<td></td>
<td align="center"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left">where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>œï</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\phi_j</annotation></semantics></math>
is a shape parameter</td>
</tr>
<tr class="odd">
<td>Positive continuous</td>
<td align="center">Exponential</td>
<td align="left">VA/LA</td>
<td align="left">log</td>
<td align="left">
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">E(y_{ij}) = \mu_{ij}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msubsup><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">V(y_{ij}) = \mu_{ij}^2</annotation></semantics></math>
</td>
</tr>
<tr class="even">
<td>Percent cover</td>
<td align="center">beta</td>
<td align="left">LA/EVA</td>
<td align="left">probit/logit</td>
<td align="left">
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">E(y_{ij}) = \mu_{ij}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>‚àí</mo><msub><mi>Œº</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>+</mo><msub><mi>œï</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">V(\mu_{ij}) = \mu_{ij}(1-\mu_{ij})/(1+\phi_j)</annotation></semantics></math>
</td>
</tr>
<tr class="odd">
<td>Percent cover with zeros/ones</td>
<td align="center">ordered beta</td>
<td align="left">EVA</td>
<td align="left">probit</td>
<td align="left">details in Korhonen et al (2024)</td>
</tr>
<tr class="even">
<td></td>
<td align="center">beta hurdle</td>
<td align="left">EVA</td>
<td align="left">probit</td>
<td align="left"></td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="model-based-ordination">Model-based ordination<a class="anchor" aria-label="anchor" href="#model-based-ordination"></a>
</h3>
<p>GLLVMs can be used as a model-based approach to unconstrained
ordination by including (<em>e.g.</em>) two latent variables in the
model but no predictors. The corresponding ordination plot then provides
a graphical representation of which sites are similar in terms of their
species composition. Such a model can be fitted to the ant data using
the function <code>gllvm</code> as below. We will consider two count
distributions for the data ‚Äì the Poisson and negative binomial (NB).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fitp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span><span class="va">y</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fitp</span></span>
<span><span class="co">#&gt; Call: </span></span>
<span><span class="co">#&gt; gllvm(y = y, family = poisson())</span></span>
<span><span class="co">#&gt; family: </span></span>
<span><span class="co">#&gt; [1] "poisson"</span></span>
<span><span class="co">#&gt; method: </span></span>
<span><span class="co">#&gt; [1] "VA"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; log-likelihood:  -2098.631 </span></span>
<span><span class="co">#&gt; Residual degrees of freedom:  1108 </span></span>
<span><span class="co">#&gt; AIC:  4441.261 </span></span>
<span><span class="co">#&gt; AICc:  4468.372 </span></span>
<span><span class="co">#&gt; BIC:  5065.263</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_ord</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span><span class="va">y</span>, family <span class="op">=</span> <span class="st">"negative.binomial"</span><span class="op">)</span></span>
<span><span class="va">fit_ord</span></span>
<span><span class="co">#&gt; Call: </span></span>
<span><span class="co">#&gt; gllvm(y = y, family = "negative.binomial")</span></span>
<span><span class="co">#&gt; family: </span></span>
<span><span class="co">#&gt; [1] "negative.binomial"</span></span>
<span><span class="co">#&gt; method: </span></span>
<span><span class="co">#&gt; [1] "VA"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; log-likelihood:  -1865.085 </span></span>
<span><span class="co">#&gt; Residual degrees of freedom:  1067 </span></span>
<span><span class="co">#&gt; AIC:  4056.17 </span></span>
<span><span class="co">#&gt; AICc:  4106.324 </span></span>
<span><span class="co">#&gt; BIC:  4889.878</span></span></code></pre></div>
<p>As a model-based ordination method, GLLVMs offer tools for the model
checking in contrast to the classical algorithm-based ordination methods
such as nMDS. For example, the default printout above includes
information criteria, which all suggest that the NB distribution is a
better choice than the Poisson distribution for modelling the
response.</p>
<p>In addition to information criteria, we can use residual plots for
diagnosing model fit. As a default, <code>plot</code> function utilizes
<code>residual</code> function to calculate Dunn-Smyth residuals, also
known as randomized quantile residuals, and then prints five residual
diagnostic plots, including a plot of residuals against linear
predictors of fitted values, a Normal Q-Q plot of residuals with a
simulated point-wise 95% confidence interval envelope, residuals against
row index and column index and scale-location plot. With an argument
<code>which</code> one can define which plots will be produced.</p>
<p>The residual diagnostics below for the Poisson model shows some
overdispersion in residuals, in particular, a telltale fan-shape in the
plot of residuals against fitted values. These issues are largely
resolved in the NB model. Note that the latent variables in the model
provide some capacity to account for overdispersion, so overdispersed
counts do not always require us to move beyond the Poisson distribution,
although there is clear evidence of such a need in this example.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot residuals for the Poisson model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fitp</span>, var.colors <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette1_files/figure-html/unnamed-chunk-11-1.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot residuals for the NB model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit_ord</span>, var.colors <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette1_files/figure-html/unnamed-chunk-12-1.png" width="480" style="display: block; margin: auto;"></p>
<p>Once an appropriate model has been established for the data, we can
construct an ordination as a scatter plot of the predicted latent
variables via the <code>ordiplot</code> function. The species with the
largest factor loadings (largest norms,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">|</mo><mo stretchy="true" form="postfix">|</mo></mrow><msub><mi>ùõâ</mi><mi>j</mi></msub><mrow><mo stretchy="true" form="prefix">|</mo><mo stretchy="true" form="postfix">|</mo></mrow></mrow><annotation encoding="application/x-tex">||\boldsymbol\theta_j||</annotation></semantics></math>),
and hence most strongly associated with ordination scores, can be added
using the logical argument <code>biplot</code>, leading to a biplot for
finding indicator species corresponding to specific sites. The
<code>ind.spp</code> argument defines the number of species to be
plotted.</p>
<p>The command below creates the biplot and the ordination plot based on
the GLLVM fitted to the <code>antTraits</code> data. We can see one
large cluster of sites on the top with many indicator species, and few
smaller clusters with only few indicator species <em>e.g.</em> sites
12‚Äì15. 95% prediction regions in the ordiplot give some clue of the
uncertainty of the estimates. The rotation and scale of the latent
variables and loadings below differ from the actual values as in order
to produce the biplot the predicted latent variables and their loadings
are rotated and scaled so that the factor loadings of the species are in
the same direction with the sites where they are most abundant.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ordiplot.gllvm.html">ordiplot</a></span><span class="op">(</span><span class="va">fit_ord</span>, biplot <span class="op">=</span> <span class="cn">TRUE</span>, ind.spp <span class="op">=</span> <span class="fl">15</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>, </span>
<span>         main <span class="op">=</span> <span class="st">"Biplot"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ordiplot.gllvm.html">ordiplot</a></span><span class="op">(</span><span class="va">fit_ord</span>, biplot <span class="op">=</span> <span class="cn">FALSE</span>, ind.spp <span class="op">=</span> <span class="fl">15</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>, </span>
<span>         main <span class="op">=</span> <span class="st">"Ordination plot"</span>, predict.region <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette1_files/figure-html/unnamed-chunk-13-1.png" width="70%" style="display: block; margin: auto;"><img src="vignette1_files/figure-html/unnamed-chunk-13-2.png" width="70%" style="display: block; margin: auto;"></p>
<p>Sometimes species names in the biplot might be hard to read,
especially when species names are long or if they are close to each
other. In order to make the figure easier to read we can change the
sizes of the species names in the biplot using <code>cex.spp</code>. If
species or site names are too close to each other we can use
<code>jitter = TRUE</code> in order to add some random variation in the
species and site locations. We can also shorten the species names. This
can also be done after the model is fitted by directly changing the row
names in the loading matrix, see the example below.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">fit_ord</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">theta</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"spp"</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">fit_ord</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ordiplot.gllvm.html">ordiplot</a></span><span class="op">(</span><span class="va">fit_ord</span>, biplot <span class="op">=</span> <span class="cn">TRUE</span>, ind.spp <span class="op">=</span> <span class="fl">15</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">1.6</span><span class="op">)</span>, </span>
<span>         main <span class="op">=</span> <span class="st">"Biplot"</span>, jitter <span class="op">=</span> <span class="cn">TRUE</span>, cex.spp <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette1_files/figure-html/unnamed-chunk-14-1.png" width="70%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="model-with-environmental-variables">Model with environmental variables<a class="anchor" aria-label="anchor" href="#model-with-environmental-variables"></a>
</h3>
<p>Environmental variables can be included in the model, whether to
study their effects on assemblages, or to study patterns of species
co-occurrence after controlling for environmental variables. We
illustrate here this model by including three environmental variables
<code>Bare.ground</code>, <code>Canopy.cover</code> and
<code>Volume.lying.CWD</code> to the model. Similarly to previous
example, we can use residual analysis and information criteria to study
which distribution offers the most suitable mean-variance relationship
for the responses, and how many latent variables are needed.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">criteria</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">fiti</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span>, family <span class="op">=</span> <span class="st">"negative.binomial"</span>, num.lv <span class="op">=</span> <span class="va">i</span>, sd.errors <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                formula <span class="op">=</span> <span class="op">~</span> <span class="va">Bare.ground</span> <span class="op">+</span> <span class="va">Canopy.cover</span> <span class="op">+</span> <span class="va">Volume.lying.CWD</span>, seed <span class="op">=</span> <span class="fl">1234</span><span class="op">)</span></span>
<span>  <span class="va">criteria</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fiti</span><span class="op">)</span><span class="op">$</span><span class="va">AICc</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">criteria</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">i</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compare AICc values</span></span>
<span><span class="va">criteria</span></span>
<span><span class="co">#&gt;        1        2        3        4        5 </span></span>
<span><span class="co">#&gt; 4163.565 4215.446 4311.091 4462.069 4612.805</span></span></code></pre></div>
<p>Based on these tools a model with NB distributed responses and 1
latent variable was chosen.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_env</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span>, family <span class="op">=</span> <span class="st">"negative.binomial"</span>, num.lv <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                 formula <span class="op">=</span> <span class="op">~</span> <span class="va">Bare.ground</span> <span class="op">+</span> <span class="va">Canopy.cover</span> <span class="op">+</span></span>
<span>                   <span class="va">Volume.lying.CWD</span>, seed <span class="op">=</span> <span class="fl">1234</span><span class="op">)</span></span></code></pre></div>
<p>The estimated coefficients for predictors and their confidence
intervals can be plotted using the <code>coefplot</code> function, in
order to study the nature of effects of environmental variables on
species. Function <code>coefplot</code> plots the point estimates
(ticks) for coefficients of the environmental variables and their 95%
confidence intervals (lines) for the <code>fit_env</code> model, with
those colored in grey (black) denoting intervals (not) containing
zero.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/coefplot.gllvm.html">coefplot</a></span><span class="op">(</span><span class="va">fit_env</span>, cex.ylab <span class="op">=</span> <span class="fl">0.7</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">9</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>, mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette1_files/figure-html/unnamed-chunk-18-1.png" width="49%" style="display: block; margin: auto;"><img src="vignette1_files/figure-html/unnamed-chunk-18-2.png" width="49%" style="display: block; margin: auto;"><img src="vignette1_files/figure-html/unnamed-chunk-18-3.png" width="49%" style="display: block; margin: auto;"></p>
<p>In the resulting plot above most of the 95% confidence intervals
include zero, indicating that the majority of the species do not exhibit
evidence of a strong association between environment and species
abundance. This may be due to a lack of information in the data, as much
as being due to a lack of environmental association after accounting for
potential residual species covariation. The extreme effect sizes of
covariates <code>Canopy.cover</code> and <code>Volume.lying.CWD</code>
are explained by the fact that species
<code>Myrmecia.pilosula.complex</code> and
<code>Ochetellus.glaber</code> were observed only in sites where percent
canopy cover was zero and species
<code>Cardiocondyla.nuda.atalanta</code> was observed mainly on sites
where estimated volume of Coarse Woody Debris was zero and only once in
other sites. Due such lack of variation the effects sizes tend to become
extreme.</p>
<p>Similarly to the biplot, the species names in the coefficient plot
can also be changed by changing the row names in the coefficient matrix.
Species ordering according to the effects‚Äô sizes is optional with
logical argument <code>order</code>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">fit_env</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">Xcoef</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"spp"</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">fit_env</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/coefplot.gllvm.html">coefplot</a></span><span class="op">(</span><span class="va">fit_env</span>, cex.ylab <span class="op">=</span> <span class="fl">0.7</span>, order <span class="op">=</span> <span class="cn">FALSE</span>, mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette1_files/figure-html/unnamed-chunk-19-1.png" width="49%" style="display: block; margin: auto;"><img src="vignette1_files/figure-html/unnamed-chunk-19-2.png" width="49%" style="display: block; margin: auto;"><img src="vignette1_files/figure-html/unnamed-chunk-19-3.png" width="49%" style="display: block; margin: auto;"></p>
<p>Alternatively, model-selection on covariates, latent variables or
both can be performed by dredging, using the MuMIn package. Though
especially for large datasets with many covariates and latent variables,
this can take a while to run.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">MuMIn</span><span class="op">)</span></span>
<span><span class="va">fit_table</span> <span class="op">&lt;-</span> <span class="fu">dredge</span><span class="op">(</span><span class="va">fiti</span>,varying<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>num.lv<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>, rank<span class="op">=</span><span class="st">"AICc"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">fit_table</span>, <span class="va">delta</span><span class="op">&lt;</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># Global model call: gllvm(y = y, X = X, formula = ~Bare.ground + Canopy.cover +  Volume.lying.CWD, </span></span>
<span><span class="co">#     family = "negative.binomial", num.lv = i, sd.errors = FALSE, </span></span>
<span><span class="co">#     seed = 1234)</span></span>
<span><span class="co"># ---</span></span>
<span><span class="co"># Model selection table </span></span>
<span><span class="co">#    (Int) Cnp.cvr num.lv  df    logLik   AICc delta weight</span></span>
<span><span class="co"># 11     +       +      1 164 -1839.914 4058.6     0      1</span></span>
<span><span class="co"># Models ranked by AICc(x) </span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="studying-co-occurrence-patterns">Studying co-occurrence patterns<a class="anchor" aria-label="anchor" href="#studying-co-occurrence-patterns"></a>
</h3>
<p>Latent variables induce correlation across response variables, and so
provide a means of estimating correlation patterns across species, and
the extent to which they can be explained by environmental variables.
Information on correlation is stored in the factor loadings
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ùõâ</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\boldsymbol\theta_j</annotation></semantics></math>,
so the residual covariance matrix, storing information on species
co-occurrence that is not explained by environmental variables, can be
calculated as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùö∫</mi><mo>=</mo><mi>ùö™</mi><msup><mi>ùö™</mi><mi>‚ä§</mi></msup></mrow><annotation encoding="application/x-tex">\boldsymbol\Sigma=\boldsymbol\Gamma \boldsymbol\Gamma^\top</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ùö™</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>ùõâ</mi><mn>1</mn></msub><mi>‚Ä¶</mi><msub><mi>ùõâ</mi><mi>m</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow><mi>‚Ä≤</mi></mrow><annotation encoding="application/x-tex">\boldsymbol\Gamma = [\boldsymbol\theta_1\dots\boldsymbol\theta_m]'</annotation></semantics></math>.
The <code>getResidualCor</code> function can be used to estimate the
correlation matrix of the linear predictor across species. This can be
visualised using the <code>corrplot</code> package:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Residual correlation matrix:</span></span>
<span><span class="va">cr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getResidualCor.gllvm.html">getResidualCor</a></span><span class="op">(</span><span class="va">fit_env</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/taiyun/corrplot" class="external-link">corrplot</a></span><span class="op">)</span>; <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gclus</span><span class="op">)</span></span>
<span><span class="co">#&gt; corrplot 0.95 loaded</span></span>
<span><span class="co">#&gt; Loading required package: cluster</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html" class="external-link">corrplot</a></span><span class="op">(</span><span class="va">cr</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/gclus/man/order.html" class="external-link">order.single</a></span><span class="op">(</span><span class="va">cr</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/gclus/man/order.html" class="external-link">order.single</a></span><span class="op">(</span><span class="va">cr</span><span class="op">)</span><span class="op">]</span>, diag <span class="op">=</span> <span class="cn">FALSE</span>, type <span class="op">=</span> <span class="st">"lower"</span>, </span>
<span>         method <span class="op">=</span> <span class="st">"square"</span>, tl.cex <span class="op">=</span> <span class="fl">0.5</span>, tl.srt <span class="op">=</span> <span class="fl">45</span>, tl.col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette1_files/figure-html/unnamed-chunk-23-1.png" width="480" style="display: block; margin: auto;"></p>
<p>Group of squares coloured in dark blue in correlation plot indicate
clusters of species that are positively correlated with each other,
after controlling for (co)variation in species explained by
environmental terms in <code>fit_env</code> (which had linear terms for
<code>Bare.ground</code>, <code>Canopy.cover</code> and
<code>Volumn.lying.CWD</code>). There are also group of squares coloured
in red, indicating negative correlation between pairs of species. The
effect of the environmental variables on the between species
correlations can be seen by comparing the residual correlation matrix
(above) to the correlation matrix given by the model without
environmental variables (below).</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit GLLVM without environmental variables and 1 latent variable:</span></span>
<span><span class="va">fit1lv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span><span class="va">y</span>, family <span class="op">=</span> <span class="st">"negative.binomial"</span>, num.lv <span class="op">=</span> <span class="fl">1</span>, seed <span class="op">=</span> <span class="fl">1234</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Correlation matrix</span></span>
<span><span class="va">cr0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getResidualCor.gllvm.html">getResidualCor</a></span><span class="op">(</span><span class="va">fit1lv</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html" class="external-link">corrplot</a></span><span class="op">(</span><span class="va">cr0</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/gclus/man/order.html" class="external-link">order.single</a></span><span class="op">(</span><span class="va">cr0</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/gclus/man/order.html" class="external-link">order.single</a></span><span class="op">(</span><span class="va">cr0</span><span class="op">)</span><span class="op">]</span>, diag <span class="op">=</span> <span class="cn">FALSE</span>, type <span class="op">=</span> <span class="st">"lower"</span>, </span>
<span>         method <span class="op">=</span> <span class="st">"square"</span>, tl.cex <span class="op">=</span> <span class="fl">0.5</span>, tl.srt <span class="op">=</span> <span class="fl">45</span>, tl.col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette1_files/figure-html/unnamed-chunk-25-1.png" width="480" style="display: block; margin: auto;"></p>
<p>Residual correlations can also be visualized in a residual biplot,
where highly correlated species tend to lie in the same direction and
negatively correlated species at the opposite side of the biplot, see
figure (b) below. In order to do that we fit the <code>fit_env</code>
model with two latent variables and compare it to the model without
predictors <code>fit_ord</code> (a).</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_env2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span>, family <span class="op">=</span> <span class="st">"negative.binomial"</span>, num.lv <span class="op">=</span> <span class="fl">2</span>, </span>
<span>                  formula <span class="op">=</span> <span class="op">~</span> <span class="va">Bare.ground</span> <span class="op">+</span> <span class="va">Canopy.cover</span> <span class="op">+</span> </span>
<span>                    <span class="va">Volume.lying.CWD</span>, seed <span class="op">=</span> <span class="fl">12345</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">fit_env2</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">theta</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"sp"</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">fit_env2</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ordiplot.gllvm.html">ordiplot</a></span><span class="op">(</span><span class="va">fit_ord</span>, biplot <span class="op">=</span> <span class="cn">TRUE</span>, ind.spp <span class="op">=</span> <span class="fl">15</span>, jitter <span class="op">=</span> <span class="cn">TRUE</span>, cex.spp <span class="op">=</span> <span class="fl">1</span>,</span>
<span>         xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>, <span class="fl">3.5</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2.5</span>, <span class="fl">2</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"(a)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ordiplot.gllvm.html">ordiplot</a></span><span class="op">(</span><span class="va">fit_env2</span>, biplot <span class="op">=</span> <span class="cn">TRUE</span>, ind.spp <span class="op">=</span> <span class="fl">15</span>, jitter <span class="op">=</span> <span class="cn">TRUE</span>, cex.spp <span class="op">=</span> <span class="fl">1</span>,</span>
<span>         xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>, <span class="fl">3.5</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2.5</span>, <span class="fl">2</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"(b)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette1_files/figure-html/unnamed-chunk-26-1.png" width="49%" style="display: block; margin: auto;"><img src="vignette1_files/figure-html/unnamed-chunk-26-2.png" width="49%" style="display: block; margin: auto;"></p>
<p>In both biplots we can see that species 23 (Monomorium.rothsteini),
24 (Monomorium.sydneyense), 28 (Nylanderia.sp..A) and 41
(Tetramorium.sp..A) are close to each other. This can also be seen in
the correlation plots as their between species correlations are highly
positive.</p>
<p>The <code>getResidualCov</code> function can be used to quantify the
amount of variation in the data that can be explained by environmental
variables. Specifically, if we use the trace of the residual covariance
matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùö∫</mi><annotation encoding="application/x-tex">\boldsymbol\Sigma</annotation></semantics></math>
as a measure of unexplained variation, then we can compare this quantity
before and after environmental variables are included in the model. The
ratio of traces suggests that environmental variables explain
approximately 40% of the (co)variation in ant species abundances.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rcov</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getResidualCov.gllvm.html">getResidualCov</a></span><span class="op">(</span><span class="va">fit_env</span>, adjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">rcov0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getResidualCov.gllvm.html">getResidualCov</a></span><span class="op">(</span><span class="va">fit1lv</span>, adjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">rcov0</span><span class="op">$</span><span class="va">trace</span>; <span class="va">rcov</span><span class="op">$</span><span class="va">trace</span></span>
<span><span class="co">#&gt; [1] 44.09111</span></span>
<span><span class="co">#&gt; [1] 25.82819</span></span>
<span><span class="fl">1</span> <span class="op">-</span> <span class="va">rcov</span><span class="op">$</span><span class="va">trace</span> <span class="op">/</span> <span class="va">rcov0</span><span class="op">$</span><span class="va">trace</span></span>
<span><span class="co">#&gt; [1] 0.4142085</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="incorporating-functional-traits-into-fourth-corner-models">Incorporating functional traits into fourth corner models<a class="anchor" aria-label="anchor" href="#incorporating-functional-traits-into-fourth-corner-models"></a>
</h3>
<p>In the previous section, environmental associations were studied by
fitting separate terms for each species, without attempting to explain
why different species respond differently to the environment. Adding
functional traits to the model offers the potential to explain why
species differ in environmental response.</p>
<p>The fourth corner model can be fitted using the argument
<code>TR</code> to include traits. The argument <code>formula</code> is
used to specify the model. Community level random row effects are
included using <code>row.eff = "random"</code> and the argument
<code>randomX</code> is used to incorporate random slopes in the model.
As the defined model is very complex, we use three starting points for
the initial values of the latent variables via argument
<code>n.init</code> in order to ensure that the maximum point is
reached.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_4th</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span>, <span class="va">TR</span>, family <span class="op">=</span> <span class="st">"negative.binomial"</span>, num.lv <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                 formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="op">(</span><span class="va">Bare.ground</span> <span class="op">+</span> <span class="va">Canopy.cover</span> <span class="op">+</span> <span class="va">Volume.lying.CWD</span><span class="op">)</span> <span class="op">+</span></span>
<span>                <span class="op">(</span><span class="va">Bare.ground</span> <span class="op">+</span> <span class="va">Canopy.cover</span> <span class="op">+</span> <span class="va">Volume.lying.CWD</span><span class="op">)</span> <span class="op">:</span> <span class="op">(</span><span class="va">Pilosity</span> <span class="op">+</span> </span>
<span>                <span class="va">Polymorphism</span> <span class="op">+</span> <span class="va">Webers.length</span><span class="op">)</span>, seed <span class="op">=</span> <span class="fl">123</span>,</span>
<span>                row.eff <span class="op">=</span> <span class="st">"random"</span>, control.start <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n.init <span class="op">=</span> <span class="fl">3</span>, jitter.var <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span>,</span>
<span>                randomX <span class="op">=</span> <span class="op">~</span> <span class="va">Bare.ground</span> <span class="op">+</span> <span class="va">Canopy.cover</span> <span class="op">+</span> <span class="va">Volume.lying.CWD</span><span class="op">)</span></span></code></pre></div>
<p>As previously, coefficients can be plotted using the function
<code>coefplot</code>. The environmental-trait interaction terms, also
known as the fourth corner terms, can be visualized using the function
<code>levelplot</code> from the package <code>lattice</code>, see below.
The resulting plots indicate that interactions of the trait variable
<code>Polymorphism</code> with <code>Bare.ground</code> and
<code>Canopy.cover</code>, <code>Pilosity3</code> with
<code>Canopy.cover</code> have the strongest effects on ant
abundances.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lattice.r-forge.r-project.org/" class="external-link">lattice</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/coefplot.gllvm.html">coefplot.gllvm</a></span><span class="op">(</span><span class="va">fit_4th</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">11</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, cex.ylab <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="va">fourth</span> <span class="op">&lt;-</span> <span class="va">fit_4th</span><span class="op">$</span><span class="va">fourth.corner</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fl">1.5</span></span>
<span><span class="va">colort</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html" class="external-link">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"white"</span>, <span class="st">"red"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">plot.4th</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/levelplot.html" class="external-link">levelplot</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">fourth</span><span class="op">)</span><span class="op">)</span>, xlab <span class="op">=</span> <span class="st">"Environmental Variables"</span>, </span>
<span>                      ylab <span class="op">=</span> <span class="st">"Species traits"</span>, col.regions <span class="op">=</span> <span class="fu">colort</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, cex.lab <span class="op">=</span> <span class="fl">1.3</span>, </span>
<span>                      at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="va">a</span>, <span class="va">a</span>, length <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>, scales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>rot <span class="op">=</span> <span class="fl">45</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">plot.4th</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="F4coef.png" alt="plot of chunk F4 1"><p class="caption">
coefplot
</p>
</div>
<div class="figure" style="text-align: center">
<img src="F4.png" alt="plot of chunk F4 2"><p class="caption">
fourth corner plot
</p>
</div>
</div>
<div class="section level3">
<h3 id="example-model-based-inference">Example: Model-based inference<a class="anchor" aria-label="anchor" href="#example-model-based-inference"></a>
</h3>
<p>A key point of departure in the <code>gllvm</code> package, as
compared to alternative ways to fit GLLVMs, is that by using a maximum
likelihood framework, likelihood-based machinery becomes available for
inference. A particular example is likelihood ratio testing, available
via the <code>anova</code> function when comparing nested models. It
should be noted however that such tests can only be expected to maintain
(close to) valid Type I error rates when the number of parameters
involved in the model is small (they rely on
large-<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>-small-<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>m</mi><annotation encoding="application/x-tex">m</annotation></semantics></math>
asymptotics).</p>
<p>In the previous example, trait-environment interactions seem to be
relatively small and most of the confidence intervals include zero
values. Using a likelihood ratio test we can test if the traits vary
with environment. Below, the model without traits is fitted and the
likelihood ratio test comparing this model to the previous one is
performed. Based on the output when applying the <code>anova</code>
function, the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
value suggests that the fourth corner model with interactions is more
appropriate. Notice that in order to separate the model with only main
effects for environmental variables from the one which has species
specific coefficients for environmental variables, we include
<code>TR</code> matrix to the function call.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_4th2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span>, <span class="va">TR</span>, family <span class="op">=</span> <span class="st">"negative.binomial"</span>, num.lv <span class="op">=</span> <span class="fl">1</span>, </span>
<span>        formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="op">(</span><span class="va">Bare.ground</span> <span class="op">+</span> <span class="va">Canopy.cover</span> <span class="op">+</span> <span class="va">Volume.lying.CWD</span><span class="op">)</span>, seed <span class="op">=</span> <span class="fl">123</span>,</span>
<span>                 row.eff <span class="op">=</span> <span class="st">"random"</span>, control.start <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n.init <span class="op">=</span> <span class="fl">3</span>, jitter.var <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span>,</span>
<span>                 randomX <span class="op">=</span> <span class="op">~</span> <span class="va">Bare.ground</span> <span class="op">+</span> <span class="va">Canopy.cover</span> <span class="op">+</span> <span class="va">Volume.lying.CWD</span><span class="op">)</span></span>
<span><span class="co"># Test interactions using likelihood ratio test:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">fit_4th</span>, <span class="va">fit_4th2</span><span class="op">)</span></span>
<span><span class="co"># Model  1 :  y ~ (Bare.ground + Canopy.cover + Volume.lying.CWD) </span></span>
<span><span class="co"># Model  2 :  y ~ (Bare.ground + Canopy.cover + Volume.lying.CWD) + (Bare.ground + </span></span>
<span><span class="co"># Canopy.cover + Volume.lying.CWD):(Pilosity + Polymorphism + Webers.length) </span></span>
<span><span class="co"># Resid.Df        D Df.diff     P.value</span></span>
<span><span class="co"># 1     1097  0.00000       0            </span></span>
<span><span class="co"># 2     1079 61.26473      18 1.27598e-06</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Niku2019" class="csl-entry">
Niku, J., F.K.C. Hui, S. Taskinen, and D.I. Warton. 2019. <span>‚ÄúGllvm -
Fast Analysis of Multivariate Abundance Data with Generalized Linear
Latent Variable Models in R.‚Äù</span> 10: 2173‚Äì82.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jenni Niku, Wesley Brooks, Riki Herliansyah, Francis K.C. Hui, Pekka Korhonen, Sara Taskinen, Bert van der Veen, David I. Warton.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
